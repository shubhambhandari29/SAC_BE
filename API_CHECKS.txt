
/login

{
  "email": "akshat.gupta@dummy.com",
  "password": "12345678"
}

response :


{
  "message": "Sign in successful",
  "user": {
    "id": 1001,
    "first_name": "Akshat",
    "last_name": "Gupta",
    "email": "akshat.gupta@dummy.com",
    "role": "Underwriter"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTAwMSwiZmlyc3RfbmFtZSI6IkFrc2hhdCIsImxhc3RfbmFtZSI6Ikd1cHRhIiwiZW1haWwiOiJha3NoYXQuZ3VwdGFAZHVtbXkuY29tIiwicm9sZSI6IlVuZGVyd3JpdGVyIiwiZXhwIjoxNzY1MjkzMDE3LCJ1c2VyIjp7ImlkIjoxMDAxLCJmaXJzdF9uYW1lIjoiQWtzaGF0IiwibGFzdF9uYW1lIjoiR3VwdGEiLCJlbWFpbCI6ImFrc2hhdC5ndXB0YUBkdW1teS5jb20iLCJyb2xlIjoiVW5kZXJ3cml0ZXIifX0.CWmLgVxm9KiWcNi02c_IDaABi3pC7d21bUuBeuFwndA"
}



/auth/me : GET

response :

{
  "message": "User authenticated",
  "user": {
    "id": 1,
    "first_name": "Test",
    "last_name": "User",
    "email": "test@example.com",
    "role": "admin"
  },
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiZmlyc3RfbmFtZSI6IlRlc3QiLCJsYXN0X25hbWUiOiJVc2VyIiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwicm9sZSI6ImFkbWluIiwiZXhwIjoxNzY0MTk4MjQxLCJ1c2VyIjp7ImlkIjoxLCJmaXJzdF9uYW1lIjoiVGVzdCIsImxhc3RfbmFtZSI6IlVzZXIiLCJlbWFpbCI6InRlc3RAZXhhbXBsZS5jb20iLCJyb2xlIjoiYWRtaW4ifX0.7iRf_aMnPfy-ZwpY0e0paH6nsLqHlv2wLsR5wx-8c2E"
}

http://127.0.0.1:8000/auth/logout

{
  "message": "Logged out successfully"
}


------------------------

GET /sac_account/

Response :

[
  {
    "CustomerNum": "CUST001",
    "CustomerName": "Acme Corp",
    "OnBoardDate": null,
    "ServLevel": "Gold",
    "Stage": "user",
    "isSubmitted": true,
    "AcctOwner": "Alice"
  },
  {
    "CustomerNum": "CUST002",
    "CustomerName": "Acme Corp",
    "OnBoardDate": null,
    "ServLevel": "Gold",
    "Stage": "admin",
    "isSubmitted": true,
    "AcctOwner": "Alice"
  }
]


/sac_account/upsert

Request :

{
  "CustomerNum": "0006952398",
  "CustomerName": "Hub City Ford",
  "OnBoardDate": "2010-03-17",
  "ServLevel": "3.Essential",
  "Stage": "Admin",
  "isSubmitted": "1",
  "AcctOwner": "Marc De Luca",
"BusinessType":"Special Account"

}

Response :

{
  "message": "Transaction successful",
  "count": 1
}


---------------------------

GET /sac_policies

[
  {
    "CustomerNum": "CUST001",
    "PolicyNum": "POL001",
    "PolMod": "00",
    "ServLevel": "Gold",
    "Stage": null,
    "AcctOwner": null,
    "isSubmitted": null,
    "AgentCode": null,
    "AgentName": null,
    "AccountName": null,
    "InceptDate": null,
    "AcctOnPolicyName": null
  }
]

/sac_policies/upsert

Request

{
  "CustomerNum": "1508385396",
  "PolicyNum": "9671764",
  "PolMod": "01",
  "AccountActiveYN": "N",
  "AccountName": "No",
  "AcctOnPolicyName": "Arba Inc The",
  "PremiumAmt": "8608.00",
  "PolicyType": "General liability",
  "AgentCode": "1606177",
  "AgentName": "MCGRIFF SEIBELS WILLIAMS",
  "InceptDate": "2013-07-01"
}

Response :

{
  "message": "Transaction successful",
  "count": 1
}

/sac_policies/update_field_for_all_policies


request :

{
  "fieldName": "AccountName",
  "fieldValue": "yes",
  "updateVia": "CustomerNum",
  "updateViaValue": "1508385396"
}


response :

{
  "message": "Update successful"
}


-----------------------------------------------------------------------------


/search_sac_account/search_by="policyNum"

response :

[
  {
    "Policy Number": "POL001",
    "Customer Number": "CUST002",
    "Customer Name": "Acme Corp",
    "On Board Date": null,
    "Service Level": "Gold"
  }
]


-----------------------------------------------------

/GET /loss_run_distribution

response :


[
  {
    "CustomerNum": "CUST001",
    "EMailAddress": "lossrun@acme.com"
  }
]

 /loss_run_distribution/upsert

 request :

 [
  {
    "CustomerNum": "1111222",
    "RecipCat": "abcccc",
    "DistVia": "xyz",
    "EmailAddress": "user@example.com"
  }
]


response : 

{
  "message": "Transaction successful",
  "count": 1
}


/loss_run_distribution/delete

request:

 [
  {
    "CustomerNum": "1111222",
    "RecipCat": "abcccc",
    "DistVia": "xyz",
    "EMailAddress": "user@example.com",
    "additionalProp1": {}
  }
]


response :

{
  "message": "Deletion successful",
  "count": 1
}



GET /claim_review_distribution

response :

[
  {
    "CustomerNum": "CUST001",
    "EMailAddress": "claims@example.com",
    "RecipientName": "Claims Team"
  },
  {
    "CustomerNum": "CUST002",
    "EMailAddress": "manager@example.com",
    "RecipientName": "Account Manager"
  }
]

/claim_review_distribution/upsert

request :

 [
  {
    "CustomerNum": "1501929738",
    "RecipCat": "Director-Claims Agency Relationssss",
    "DistVia": "Email",
"AttnTo":"Sharon Carruth",

    "EMailAddress": "scarruth@hanover.com"
  }
]


response :

{
  "message": "Transaction successful",
  "count": 1
}

POST /claim_review_distribution/delete

request :

 [
  {
    "CustomerNum": "1501929738",
    "RecipCat": "Director-Claims Agency Relationssss",
    "DistVia": "Email",
"AttnTo":"Sharon Carruth",

    "EMailAddress": "scarruth@hanover.com"
  }
]


response :

{
  "message": "Transaction successful",
  "count": 1
}


GET /deduct_bill_distribution

response:

[
  {
    "CustomerNum": "CUST001",
    "EMailAddress": "claims@example.com"
  },
  {
    "CustomerNum": "CUST002",
    "EMailAddress": "manager@example.com"
  }
]

/deduct_bill_distribution/upsert

request :

[
  {
    "CustomerNum": "1502638683",
    "RecipCat": "Agent",
    "DistVia": "Email",
    "AttnTo": "Eric Myers",
    "EMailAddress": "eric.myers@bbandt.com"
  }
]


response :

{
  "message": "Transaction successful",
  "count": 1
}

POST /deduct_bill_distribution/delete

request :

[
  {
    "CustomerNum": "1507830365",
    "RecipCat": "Agentss",
    "DistVia": "Emailss",
    "AttnTo": "Eric Myersss",
    "EMailAddress": "eric.myers@bbandt.com"
  }
]

response :

{
  "message": "Transaction successful",
  "count": 1
}


GET /loss_run_frequency

response :

[
  {
    "CustomerNum": "CUST001",
    "MthNum": 1,
    "Frequency": 12
  }
]

POST /loss_run_frequency/upsert

Request :

[
  {
    "CustomerNum": "111",
    "MthNum": 1,
    "RptMth": 7,
    "CompDate": "2025-12-10",
    "RptType": "string",
    "DelivMeth": "string"
  }
]

response :

{
  "message": "Transaction successful",
  "count": 2
}

GET /deduct_bill_frequency

response :

[
  {
    "CustomerNum": "CUST001",
    "MthNum": 1,
    "Frequency": 12
  }
]

POST /deduct_bill_frequency/upsert

Request :

[
  {
    "CustomerNum": "1111",
    "MthNum": 1,
    "RptMth": 2
  }
]

response :

{
  "message": "Transaction successful",
  "count": 2
}


GET /claim_review_frequency

response :

[
  {
    "CustomerNum": "CUST001",
    "MthNum": 1,
    "Frequency": 3
  },
  {
    "CustomerNum": "CUST002",
    "MthNum": 1,
    "Frequency": 4
  },
  {
    "CustomerNum": "CUST001",
    "MthNum": 2,
    "Frequency": 1
  },
  {
    "CustomerNum": "CUST002",
    "MthNum": 3,
    "Frequency": 2
  }
]

POST /claim_review_frequency/upsert

Request :

[
  {
    "CustomerNum": "1111",
    "MthNum": 1,
    "RptMth": 0,
    "CompDate": "2025-12-10",
    "RptType": "string",
    "DelivMeth": "string",
    "CRNumNarr": 8
  }
]

response :

{
  "message": "Transaction successful",
  "count": 2
}



/HCM USERS GET

response :

[
  {
    "UserID": "user-1",
    "FirstName": "Jane",
    "LastName": "Doe",
    "Email": "jane@example.com",
    "Role": "Manager",
    "CustomerNum": "CUST001"
  },
  {
    "UserID": "user-2",
    "FirstName": "John",
    "LastName": "Smith",
    "Email": "john@example.com",
    "Role": "Analyst",
    "CustomerNum": "CUST001"
  }
]



POST /hcm_users/upsert 
request :

[
  {
    "CustomerNum": "1511529795",
    "UserID": "tfannin",
    "UserTitle": "Risk Management",
    "UserEmail": "tfanninoud@bellsouth.net"
  }
]

response :

{
  "message": "Transaction successful",
  "count": 1
}



GET /sac_affiliates/
response :

[
  {
    "CustomerNum": "CUST001",
    "AffiliateName": "Acme Health",
    "Email": "contact@acmehealth.com",
    "Phone": "555-0101"
  },
  {
    "CustomerNum": "CUST002",
    "AffiliateName": "Wellness Partners",
    "Email": "info@wellness.com",
    "Phone": "555-0202"
  }
]


/sac_affiliates/upsert
request:

[
  {
    "CustomerNum": "000",
    "AffiliateName": "DUMMY"
  }
]

[
  {
"PK_Number":"333",
    "CustomerNum": "000",
    "AffiliateName": "DUMMY_SUMMY"
  }
]



 /sac_policies/get_premium

 20000



 update [CLMAA_SpecialAccounts].[dbo].[tblPolicies] set AccountName = 'Arba Group Inc The' where PK_number = '35697'




 SAC 1	Drop-Down	SELECT tblMGTUsers.SACName FROM tblMGTUsers ORDER BY tblMGTUsers.SACName
SAC 2	Drop-Down	SELECT tblMGTUsers.SACName, tblMGTUsers.EmpTitle, tblMGTUsers.TelNum, tblMGTUsers.EMailID FROM tblMGTUsers ORDER BY tblMGTUsers.SACName
Acct Owner	Drop-Down	SELECT tblMGTUsers.SACName, tblMGTUsers.EMailID, tblMGTUsers.EmpTitle, tblMGTUsers.TelNum, tblMGTUsers.TelExt, tblMGTUsers.LANID FROM tblMGTUsers
Created By	Drop-Down	SELECT tblMGTUsers.SACName FROM tblMGTUsers ORDER BY tblMGTUsers.SACName;
Risk Solutions 1	Drop-Down	SELECT tblLossCtrl.RepName, tblLossCtrl.LCEmail, tblLossCtrl.LCTel, tblLossCtrl.LAN_ID FROM tblLossCtrl ORDER BY tblLossCtrl.RepName;
Risk Solutions 2	Drop-Down	SELECT tblLossCtrl.RepName, tblLossCtrl.Active, tblLossCtrl.LCEmail FROM tblLossCtrl WHERE (((tblLossCtrl.Active)="Yes")) ORDER BY tblLossCtrl.RepName
Risk Mgr	Drop-Down	SELECT tblLossCtrl.RepName, tblLossCtrl.LCEmail, tblLossCtrl.LAN_ID FROM tblLossCtrl ORDER BY tblLossCtrl.RepName;



HCMUsers api is not working properly, instead of updating it inserting new rows







for uw

[
    {
        "CustomerName": "Shubhtest",
        "CustomerNum": "123456",
        "BusinessType": null,
        "ServLevel": null,
        "OnBoardDate": "16-12-2025",
        "AccountNotes": "yessss",
        "DateCreated": null,
        "CreatedBy": null,
        "SAC_Contact1": null,
        "SAC_Contact2": null,
        "LossCtlRep1": null,
        "LossCtlRep2": null,
        "BranchName": "Midwest - 13 - Illinois Branch",
        "InsuredWebsite": "aaa",
        "SHI_Complete": "Yes",
        "SHI_Comments": null,
        "AgentSeg": null,
        "ServicesReq": null,
        "AccomForm": null,
        "AccomType": null,
        "Exceptions": null,
        "ExceptType": null,
        "LossRunNotes": null,
        "ClaimRevNotes": null,
        "DeductNotes": null,
        "HCMAccess": null,
        "DiscDate": null,
        "LCF": null,
        "ProducerName": null,
        "LossRunDistFreq": null,
        "DeductDistFreq": null,
        "ClaimRevDistFreq": null,
        "AcctOwner": null,
        "OBMethod": null,
        "CRThresh": 50000.0,
        "AcctStatus": "Inactive",
        "TermDate": null,
        "TermCode": null,
        "EmpTwoTitle": null,
        "EmpTwoTel": null,
        "EmpTwoEmail": null,
        "SACApproved": null,
        "StewAcctStatus": null,
        "StewStDate": null,
        "StewEndDate": null,
        "StewEndCause": null,
        "StewComments": null,
        "AutoDeliver": null,
        "TotalPrem": null,
        "DateNotif": null,
        "RiskSolMgr": null,
        "HCM_LOC_ONLY": null,
        "RenewLetterDt": null,
        "RelatedEnt": null,
        "ChangeNotes": null,
        "NCMStatus": null,
        "NCMStartDt": null,
        "NCMEndDt": null,
        "NCMTermReason": null,
        "NCMComments": null,
        "NCMType": null,
        "Stage": "Underwriter",
        "IsSubmitted": 0
    }
]


director


[
    {
        "CustomerName": "Shubhtest",
        "CustomerNum": "123456",
        "BusinessType": "Special Account and Stewardship Account",
        "ServLevel": null,
        "OnBoardDate": "16-12-2025",
        "AccountNotes": "yessssoo",
        "DateCreated": null,
        "CreatedBy": null,
        "SAC_Contact1": "Marc De Luca",
        "SAC_Contact2": "Jenna Houle",
        "LossCtlRep1": "Richelle Chandler",
        "LossCtlRep2": "Richelle Chandler",
        "BranchName": "Midwest - 13 - Illinois Branch",
        "InsuredWebsite": "aaa",
        "SHI_Complete": "Yes",
        "SHI_Comments": null,
        "AgentSeg": null,
        "ServicesReq": null,
        "AccomForm": null,
        "AccomType": null,
        "Exceptions": null,
        "ExceptType": null,
        "LossRunNotes": null,
        "ClaimRevNotes": null,
        "DeductNotes": null,
        "HCMAccess": "Not Requested",
        "DiscDate": null,
        "LCF": null,
        "ProducerName": null,
        "LossRunDistFreq": "Not Needed",
        "DeductDistFreq": "See Notes",
        "ClaimRevDistFreq": null,
        "AcctOwner": "Sharon Carruth",
        "OBMethod": "Remote",
        "CRThresh": 50000.0,
        "AcctStatus": "Inactive",
        "TermDate": null,
        "TermCode": null,
        "EmpTwoTitle": null,
        "EmpTwoTel": null,
        "EmpTwoEmail": null,
        "SACApproved": null,
        "StewAcctStatus": null,
        "StewStDate": null,
        "StewEndDate": null,
        "StewEndCause": null,
        "StewComments": null,
        "AutoDeliver": null,
        "TotalPrem": null,
        "DateNotif": null,
        "RiskSolMgr": "Tarek Helwani",
        "HCM_LOC_ONLY": null,
        "RenewLetterDt": null,
        "RelatedEnt": null,
        "ChangeNotes": null,
        "NCMStatus": "Inactive",
        "NCMStartDt": "18-12-2025",
        "NCMEndDt": null,
        "NCMTermReason": null,
        "NCMComments": null,
        "NCMType": "demo1",
        "Stage": "Director",
        "IsSubmitted": 1
    }
]



admin


[
    {
        "CustomerName": "Shubhtest",
        "CustomerNum": "123456",
        "BusinessType": "Special Account and Stewardship Account",
        "ServLevel": "5.Exception",
        "OnBoardDate": "15-12-2025",
        "AccountNotes": "yessssoo",
        "DateCreated": null,
        "CreatedBy": null,
        "SAC_Contact1": "Marc De Luca",
        "SAC_Contact2": "Jenna Houle",
        "LossCtlRep1": "Richelle Chandler",
        "LossCtlRep2": "Richelle Chandler",
        "BranchName": "Midwest - 13 - Illinois Branch",
        "InsuredWebsite": "aaa",
        "SHI_Complete": "Yes",
        "SHI_Comments": "xasbas",
        "AgentSeg": null,
        "ServicesReq": "No",
        "AccomForm": "Yes",
        "AccomType": "demo2",
        "Exceptions": "Yes",
        "ExceptType": "LR - Decreased Frequency",
        "LossRunNotes": "nnn",
        "ClaimRevNotes": "llll",
        "DeductNotes": "aaaa",
        "HCMAccess": "Not Requested",
        "DiscDate": "2025-12-16",
        "LCF": null,
        "ProducerName": null,
        "LossRunDistFreq": "Not Needed",
        "DeductDistFreq": "See Notes",
        "ClaimRevDistFreq": null,
        "AcctOwner": "Sharon Carruth",
        "OBMethod": "Remote",
        "CRThresh": 50000.0,
        "AcctStatus": "Inactive",
        "TermDate": "13-12-2025",
        "TermCode": "Competitive Pricing",
        "EmpTwoTitle": null,
        "EmpTwoTel": null,
        "EmpTwoEmail": null,
        "SACApproved": null,
        "StewAcctStatus": null,
        "StewStDate": null,
        "StewEndDate": null,
        "StewEndCause": null,
        "StewComments": null,
        "AutoDeliver": null,
        "TotalPrem": null,
        "DateNotif": "15-12-2025",
        "RiskSolMgr": "Tarek Helwani",
        "HCM_LOC_ONLY": "Yes",
        "RenewLetterDt": null,
        "RelatedEnt": null,
        "ChangeNotes": "das c ",
        "NCMStatus": "Inactive",
        "NCMStartDt": "17-12-2025",
        "NCMEndDt": "18-12-2025",
        "NCMTermReason": "demo1",
        "NCMComments": null,
        "NCMType": "demo1",
        "Stage": "Admin",
        "IsSubmitted": 0
    }
]


async def upsert_sac_policies(data):
    """
    Update row if already exists, else insert row into tblPolicies
    """
 
    try:
        cursor = conn.cursor()
        if 'PK_Number' not in data:
                data['PK_Number'] = None
        non_identity_cols = [col for col in data.keys() if col != 'PK_Number']
 
        # Assuming `PK_Number` is the primary key / unique identifier
        merge_query = f"""
        MERGE INTO tblPolicies AS target
        USING (SELECT {", ".join(['? AS ' + col for col in data.keys()])}) AS source
        ON target.PK_Number = source.PK_Number
        WHEN MATCHED THEN
            UPDATE SET {", ".join([f"{col} = source.{col}" for col in non_identity_cols if col != 'PK_Number'])}
        WHEN NOT MATCHED THEN
            INSERT ({", ".join(non_identity_cols)})
            VALUES ({", ".join(['source.' + col for col in non_identity_cols])})
        OUTPUT INSERTED.PK_Number;
        """
 
        values = list(data.values())
        cursor.execute(merge_query, values)
        upserted_id = cursor.fetchall()
        conn.commit()
 
        return {"message": "Transaction successful", "PK_Number": upserted_id[0][0]}
    except Exception as e:
        conn.rollback()
        logger.warning(f"Insert/Update failed - {str(e)}")
        raise HTTPException(status_code=500, detail={"error": str(e)})